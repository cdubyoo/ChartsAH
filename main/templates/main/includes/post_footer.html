<div id="upvote-section" class="card-footer">
{% if user.is_authenticated %}
    <form action="{% url 'main:upvote-post' %}" method=POST>
        {% csrf_token %}
    <!-- check to see if user has already upvoted post.-->
        {%  if upvoted %}
    <button type="submit" class="btn btn-success btn-sm" id="upvote-btn" name="post_id" value="{{post.id}}"><!--i class="fa fa-gittip"></i--> Upvote </button>
        {% else %} 
    <button type="submit" class="btn btn-outline-success btn-sm" id="upvote-btn" name="post_id" value="{{post.id}}"><!--i class="fa fa-gittip"></i--> Upvote </button>
        {% endif %} 
    <p id="total_upvotes">
        {{ total_upvotes }}
    </p>
    <a href="{% url 'main:post-detail' post.id %}" class="card-link"><i class="fa fa-comment"></i> Comment</a>
    {% if post.user == user %}
    <a href="{% url 'main:post-update' post.id %}" class="card-link">Edit</a>
    <a href="{% url 'main:post-delete' post.id %}" class="card-link" style="color:red">Delete</a>
    {% endif %}
    </form>
{% else %}
Upvotes ({{ total_upvotes }}) Please login to upvote or comment.

{%  endif %}  
</div>

<script>
   $(document).on('click', '#upvote-btn', function (e) {
    e.preventDefault();
    $.ajax({
      type: 'POST',
      url: '{% url "main:upvote-post" %}',
      data: {
        postid: $('#upvote-btn').val(),
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        action: 'post'
      },
      success: function (json) {
        document.getElementById("total_upvotes").innerHTML = json['result']
      },
      error: function (xhr, errmsg, err) {

      }
    });
  })

</script>
